<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug LocalStorage</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #0f172a;
            color: #f1f5f9;
        }
        .key {
            background: #1e293b;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #6c8fc7;
        }
        .key-name {
            color: #4ade80;
            font-weight: bold;
        }
        pre {
            background: #334155;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üîç LocalStorage Debug Tool</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        
        console.log('=== DEBUGGING LOCALSTORAGE ===');
        console.log('Total items:', localStorage.length);
        
        let html = `<h2>Total Items: ${localStorage.length}</h2>`;
        
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            const value = localStorage.getItem(key);
            
            console.log('----------------------------');
            console.log('Key:', key);
            console.log('Value:', value);
            
            html += `
                <div class="key">
                    <div class="key-name">Key: ${key}</div>
                    <pre>${value}</pre>
                </div>
            `;
            
            // Try to parse if JSON
            try {
                const parsed = JSON.parse(value);
                console.log('Parsed:', parsed);
                
                // Check if it's a user
                if (parsed.email || parsed.username) {
                    console.log('‚úÖ This looks like a USER!');
                    console.log('Email:', parsed.email);
                    console.log('Username:', parsed.username);
                    console.log('First Name:', parsed.firstName);
                    console.log('Last Name:', parsed.lastName);
                    console.log('Purchased Orders:', parsed.purchasedOrders?.length || 0);
                }
            } catch (e) {
                console.log('Not JSON or parse error');
            }
        }
        
        output.innerHTML = html;
        
        // Now test the customer loading function
        console.log('\n=== TESTING CUSTOMER LOAD LOGIC ===');
        
        const customers = [];
        
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            console.log('Checking key:', key);
            console.log('Has dot?', key.includes('.'));
            console.log('Is cart?', key === 'cart');
            console.log('Is wishlist?', key === 'wishlist');
            
            // Look for user data (skip system keys)
            if (key && !key.includes('.') && key !== 'cart' && key !== 'wishlist') {
                console.log('‚úÖ Key passed filter!');
                
                try {
                    const userData = JSON.parse(localStorage.getItem(key));
                    console.log('Parsed userData:', userData);
                    console.log('Has email?', userData.email);
                    console.log('Has username?', userData.username);
                    
                    // Check if it's a valid user object
                    if (userData && (userData.email || userData.username)) {
                        console.log('‚úÖ‚úÖ VALID USER FOUND!');
                        customers.push({
                            key: key,
                            email: userData.email,
                            username: userData.username,
                            firstName: userData.firstName,
                            lastName: userData.lastName
                        });
                    }
                } catch (error) {
                    console.error('Error parsing:', error);
                }
            } else {
                console.log('‚ùå Key filtered out');
            }
        }
        
        console.log('\n=== FINAL RESULT ===');
        console.log('Total customers found:', customers.length);
        console.log('Customers:', customers);
    </script>
</body>
</html>
