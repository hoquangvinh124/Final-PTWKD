    <!DOCTYPE html>
    <html lang="en">
        <head>
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
            <link rel="stylesheet" type="text/css" href="homepage_1.css">
            <link rel="stylesheet" type="text/css" href="header-footer.css">
            <!-- Thêm vào thẻ <head> -->
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
            <link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
            <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
            <title>OLDIE ZONE</title>

            <!-- Thêm vào thẻ <footer> -->
                
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
            <script src="search.js" defer></script>
        </head>
        <body>
            <!--Header/Navbar-->
            <header>
            <nav class="navbar section-content">
                <div class="header-top">
                    <a href="#" class="nav-logo" aria-label="Trang chủ Retro Sound">
                        <img src="assets/images/shopname.jpg" width="150" height="60" alt="Retro Sound Logo">
                    </a>
                    <div class="header-icons" role="group" aria-label="Lối tắt điều hướng">
                        <button type="button" class="header-icon search-btn" aria-label="Tìm kiếm" title="Tìm kiếm">
                            <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
                        </button>
                        <button type="button" class="header-icon cart-btn" id="cartButton" aria-expanded="false" aria-controls="cartTabPanel cartModal" title="Giỏ hàng">
                            <i class="fa-solid fa-cart-shopping" aria-hidden="true"></i>
                            <span class="badge" id="cartBadge"></span>
                        </button>
                        <button type="button" class="header-icon user-btn" aria-label="Tài khoản" title="Tài khoản">
                            <i class="fa-regular fa-user" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link">AUDIO</a>
                        <ul class="submenu">
                            <li><a href="#" class="submenu-link">CD</a></li>
                            <li><a href="#" class="submenu-link">VINYL</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a href="#" class="nav-link">VHS</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">CASSETTE TAPE</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">POLA CAMERA</a></li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">ACCESSORIES</a>
                        <ul class="submenu">
                            <li><a href="#" class="submenu-link">CASSETTE PLAYER</a></li>
                            <li><a href="#" class="submenu-link">IPOD</a></li>
                            <li><a href="#" class="submenu-link">CD PLAYER</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a href="#" class="nav-link">POLA CAMERA</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">CINE ROOM</a></li>
                    <li class="nav-item"><a href="#" class="nav-link">THREAD</a></li>
                </ul>
            </nav>
                <div class="search-bar" id="searchBar">
                    <div class="search-container">
                        <input type="text" placeholder="Tìm kiếm sản phẩm..." class="search-input" id="searchInput">
                        <button class="search-close" id="searchClose" aria-label="Đóng tìm kiếm">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                </div>
        </header>
            
            <main>
                <main>
                    <!-- Hero Section (full width, không bị container giới hạn) -->
                <section class="hero-section" aria-labelledby="heroTitle">
                <div class="hero-image-wrapper">
                    <img src="assets/images/main-banner.jpg" alt="Retro Sound main banner" class="main-banner">
                    <div class="hero-overlay"></div>
                    <div class="hero-content">
                        <p class="eyebrow">Âm thanh cổ điển cho thế hệ mới</p>
                        <h1 id="heroTitle">Khám phá kho báu Retro Sound</h1>
                        <p class="hero-description">Từ vinyl nguyên bản, máy ảnh pola cho đến cassette hiếm – tất cả được tuyển chọn để giúp bạn sống lại kỷ nguyên vàng của âm nhạc và điện ảnh.</p>
                        <div class="hero-actions">
                            <a href="#" class="btn-retro primary">Khám phá ngay</a>
                            <a href="#" class="btn-retro ghost">Xem bộ sưu tập</a>
                        </div>
                    </div>
                </div>
            </section>

                    <!-- Product Banner Section (có margin 2 bên 250px) -->
                    <section class="product-banner">
                        <div class="grid-layout">
                            <!-- Banner 1 (bên trái) -->
                            <div class="left-side">
                                <img src="assets/images/Banner1.jpg" alt="Banner 1">
                            </div>

                            <!-- Bên phải: Banner 2 + Banner 3 -->
                            <div class="right-side">
                                <div class="banner banner2">
                                    <img src="assets/images/Banner2.jpg" alt="Banner 2">
                                </div>
                                <div class="banner banner3">
                                    <img src="assets/images/Banner3.jpg" alt="Banner 3">
                                </div>
                            </div>
                        </div>
                    </section>
                </main>
            </main>
            <section class="story" aria-labelledby="storyTitle">
                <div class="story-inner">
                    <div class="story-copy">
                        <p class="eyebrow">Retro Sound Studio</p>
                        <h2 id="storyTitle">Cảm hứng từ những phòng thu thập niên 80</h2>
                        <p>Chúng tôi săn tìm từng cuộn băng, từng chiếc máy ảnh cũ trên khắp thế giới, phục chế bằng tay và kiểm tra thủ công trước khi đưa đến tay bạn. Bộ sưu tập tại Retro Sound được tuyển chọn bởi những người yêu âm nhạc và nghệ thuật analog, để mỗi sản phẩm đều mang câu chuyện riêng.</p>
                        <a href="#" class="text-link">Tìm hiểu thêm về hành trình của chúng tôi</a>
                    </div>
                    <div class="story-visual">
                        <div class="story-card">
                            <img src="assets/images/Vinyl_collection.gif" alt="Cassette collection">
                            <div class="card-glow"></div>
                        </div>
                        <div class="story-stats">
                            <div>
                                <span class="stat-number">250+</span>
                                <span class="stat-label">Bản thu giới hạn</span>
                            </div>
                            <div>
                                <span class="stat-number">50</span>
                                <span class="stat-label">Máy ảnh pola phục chế</span>
                            </div>
                            <div>
                                <span class="stat-number">30</span>
                                <span class="stat-label">Sự kiện nghe thử mỗi năm</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="best-seller-arena">
                <h2 style="text-align:center;">
                    <span class="home-text">
                        <span class="home-text">
                            <span class="home-text">
                                <span class="home-text">
                                        <span class="home-text">BEST SELLERS</span>
                                </span>
                            </span>
                        </span>
                    </span>
                </h2>
                <div class="grid" id="productGrid">
                <!-- Product Box 1 -->
                    <div class="box" height="200px">
                        <div class="item" id="sku-1" data-name="VHS 13" data-price="$90.00" data-img="../images/VHS-20251004T101836Z-1-001/VHS/13.png">
                            <div class="thumb">
                                <div class="hover-content">
                                    <ul>
                                        <li><a href="#"><i class="heart-icon"></i></a></li>
                                        <li><button class="btn add"><i class="shopping-bag-icon"></i></button></li>
                                    </ul>
                                </div>
                                <img src="assets/images/VHS/13.jpg" alt="Air Force 1 X" class="main-image">
                                <img src="assets/images/VHS/14.jpg" alt="Air Force 1 X Hover" class="hover-image">
                            </div>
                            <div class="down-content">
                                <h4>VHS 13</h4>
                                <div class="product-price">
                                    <span class="current">$90.00</span>
                                </div>
                            </div>
                        </div>    
                    </div>
                <!-- Product Box 2 -->
                    <div class="box" height="200px">
                        <div class="item" data-id="sku-1" data-name="Audio Vinyl 13" data-price="$90.00" data-img="../images/Audio-20251004T101842Z-1-001/Audio/Vinyl/13.png">
                            <div class="thumb">
                                <div class="hover-content">
                                    <ul>
                                        <li><a href="#"><i class="heart-icon"></i></a></li>
                                        <li><button class="btn add"><i class="shopping-bag-icon"></i></button></li>
                                    </ul>
                                </div>
                                <img src="assets/images/Audio/Vinyl/13.jpg" alt="Air Force 1 X" class="main-image">
                                <img src="assets/images/Audio/Vinyl/14.jpg" alt="Air Force 1 X Hover" class="hover-image">
                            </div>
                            <div class="down-content">
                                <h4>Audio Vinyl 13</h4>
                                <div class="product-price">
                                    <span class="current">$90.00</span>
                                </div>
                            </div>
                        </div>    
                    </div>
                <!-- Product Box 3 -->
                    <div class="box" height="200px">
                        <div class="item" data-id="sku-3" data-name="Cassette Tape 17" data-price="$90.00" data-img="../images/Cassette Tape-20251004T101840Z-1-001/Cassette Tape/17.png">
                            <div class="thumb">
                                <div class="hover-content">
                                    <ul>
                                        <li><a href="#"><i class="heart-icon"></i></a></li>
                                        <li><button class="btn add"><i class="shopping-bag-icon"></i></button></li>
                                    </ul>
                                </div>
                                <img src="assets/images/Cassette Tape/17.jpg" alt="Air Force 1 X" class="main-image">
                                <img src="assets/images/Cassette Tape/18.jpg" alt="Air Force 1 X Hover" class="hover-image">
                            </div>
                            <div class="down-content">
                                <h4>Cassette Tape 17</h4>
                                <div class="product-price">
                                    <span class="current">$90.00</span>
                                </div>
                            </div>
                        </div>    
                    </div>
                <!-- Product Box 4 -->
                    <div class="box" height="200px">
                        <div class="item" data-id="sku-4" data-name="Pola Camera 11" data-price="$90.00" data-img="../images/Pola Camera-20251004T101838Z-1-001/Pola Camera/11.png">
                            <div class="thumb">
                                <div class="hover-content">
                                    <ul>
                                        <li><a href="#"><i class="heart-icon"></i></a></li>
                                        <li><button class="btn add"><i class="shopping-bag-icon"></i></button></li>
                                    </ul>
                                </div>
                                <img src="assets/images/Pola Camera/11.jpg" alt="Air Force 1 X" class="main-image">
                                <img src="assets/images/Pola Camera/12.jpg" alt="Air Force 1 X Hover" class="hover-image">
                            </div>
                            <div class="down-content">
                                <h4>Pola Camera 11</h4>
                                <div class="product-price">
                                    <span class="current">$90.00</span>
                                </div>
                            </div>
                        </div>    
                    </div>
                <!-- Product Box 5 -->
                    <div class="box" height="200px">
                        <div class="item" data-id="sku-5" data-name="IPod 8" data-price="$90.00" data-img="../images/Accessories-20251004T101844Z-1-001/Accessories/IPod/8.png">
                            <div class="thumb">
                                <div class="hover-content">
                                    <ul>
                                        <li><a href="#"><i class="heart-icon"></i></a></li>
                                        <li><button class="btn add"><i class="shopping-bag-icon"></i></button></li>
                                    </ul>
                                </div>
                                <img src="assets/images/Accessories/IPod/8.jpg" alt="Air Force 1 X" class="main-image">
                                <img src="assets/images/Accessories/IPod/9.jpg" alt="Air Force 1 X Hover" class="hover-image">
                            </div>
                            <div class="down-content">
                                <h4>IPod 8</h4>
                                <div class="product-price">
                                    <span class="current">$90.00</span>
                                </div>
                            </div>
                        </div>    
                    </div>
                <!-- Product Box 6 -->
                    <div class="box" height="200px">
                        <div class="item" data-id="sku-6" data-name="CD Player 13" data-price="$90.00" data-img="../images/Accessories-20251004T101844Z-1-001/Accessories/CD Player/13.png">
                            <div class="thumb">
                                <div class="hover-content">
                                    <ul>
                                        <li><a href="#"><i class="heart-icon"></i></a></li>
                                        <li><button class="btn add"><i class="shopping-bag-icon"></i></button></li>
                                    </ul>
                                </div>
                                <img src="assets/images/CD Player/13.png" alt="Air Force 1 X" class="main-image">
                                <img src="assets/images/CD Player/14.png" alt="Air Force 1 X Hover" class="hover-image">
                            </div>
                            <div class="down-content">
                                <h4>CD Player 13</h4>
                                <div class="product-price">
                                    <span class="current">$90.00</span>
                                </div>
                            </div>
                        </div>    
                    </div>
                <!-- Product Box 7 -->
                    <div class="box" height="200px">
                        <div class="item" data-id="sku-7" data-name="Pola Camera 15" data-price="$90.00" data-img="../images/Pola Camera-20251004T101838Z-1-001/Pola Camera/15.png">
                            <div class="thumb">
                                <div class="hover-content">
                                    <ul>
                                        <li><a href="#"><i class="heart-icon"></i></a></li>
                                        <li><button class="btn add"><i class="shopping-bag-icon"></i></button></li>
                                    </ul>
                                </div>
                                <img src="assets/images/Pola Camera/15.jpg" alt="Air Force 1 X" class="main-image">
                                <img src="assets/images/Pola Camera/16.jpg" alt="Air Force 1 X Hover" class="hover-image">
                            </div>
                            <div class="down-content">
                                <h4>Pola Camera 15</h4>
                                <div class="product-price">
                                    <span class="current">$90.00</span>
                                </div>
                            </div>
                        </div>    
                    </div>
                <!-- Product Box 8 -->
                    <div class="box" height="200px">
                        <div class="item" data-id="sku-8" data-name="Audio Vinyl 14" data-img="../images/Audio-20251004T101842Z-1-001/Audio/Vinyl/14.png">
                            <div class="thumb">
                                <div class="hover-content">
                                    <ul>
                                        <li><a href="#"><i class="heart-icon"></i></a></li>
                                        <li><button class="btn add"><i class="shopping-bag-icon"></i></button>
                                        </li>
                                    </ul>
                                </div>
                                <img src="assets/images/Audio/Vinyl/13.jpg" alt="Air Force 1 X" class="main-image">
                                <img src="assets/images/Audio/Vinyl/14.jpg" alt="Air Force 1 X Hover" class="hover-image">
                            </div>
                            <div class="down-content">
                                <h4>Audio Vinyl 14</h4>
                                <div class="product-price">
                                    <span class="current">$90.00</span>
                                </div>
                            </div>
                        </div>    
                    </div>
                <!-- Product Box 9 -->
                    <div class="box" height="200px">
                        <div class="item" data-id="sku-9" data-name="VHS 39" data-price="$90.00" data-img="../images/VHS-20251004T101836Z-1-001/VHS/39.png">
                            <div class="thumb">
                                <div class="hover-content">
                                    <ul>
                                        <li><a href="#"><i class="heart-icon"></i></a></li>
                                        <button class="btn add"><i class="shopping-bag-icon"></i></button></li>
                                    </ul>
                                </div>
                                <img src="assets/images/VHS/39.jpg" alt="Air Force 1 X" class="main-image">
                                <img src="assets/images/VHS/40.jpg" alt="Air Force 1 X Hover" class="hover-image">
                            </div>
                            <div class="down-content">
                                <h4>VHS 39</h4>
                                <div class="product-price">
                                    <span class="current">$90.00</span>
                                </div>
                            </div>
                        </div>    
                    </div>
                <!-- Product Box 10 -->
                    <div class="box" height="200px">
                        <div class="item" data-id="sku-10" data-name="VHS 13" data-price="$90.00" data-img="../images/VHS-20251004T101836Z-1-001/VHS/13.png">
                            <div class="thumb">
                                <div class="hover-content">
                                    <ul>
                                        <li><a href="#"><i class="heart-icon"></i></a></li>
                                        <li><button class="btn add">+ Add to cart</button></li>
                                    </ul>
                                </div>
                                <img src="assets/images/VHS/13.jpg" alt="Air Force 1 X" class="main-image">
                                <img src="assets/images/VHS/14.jpg" alt="Air Force 1 X Hover" class="hover-image">
                            </div>
                            <div class="down-content">
                                <h4>VHS 13</h4>
                                <div class="product-price">
                                    <span class="current">$90.00</span>
                                </div>
                            </div>
                        </div>    
                    </div>
                </div>
            </section>
            <div class="overlay" id="overlay" tabindex="-1" aria-hidden="true"></div>

            <section class="modal" id="cartModal" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
                <div class="modal-head">
                <div id="cartTitle" class="modal-title">GIỎ HÀNG</div>
                    <button class="x" id="closeModal" aria-label="Đóng"></button>
                </div>
                <div class="modal-body" id="cartList">
                    <div class="empty" id="emptyState">Chưa có sản phẩm.</div>
                </div>
                <div class="modal-foot">
                    <div class="sum"><span>Tổng</span><span id="grandTotal">0₫</span></div>
                    <div class="actions">
                        <button class="btn secondary">GIỎ HÀNG</button>
                        <button class="btn">THANH TOÁN</button>
                    </div>
                    <a href="#" class="continue" id="continueLink">TIẾP TỤC MUA HÀNG</a>
                </div>
            </section>

            <div class="vaultzone">
                <div class="artifactz vinora">
                    <div class="titlemark">Vinyl</div>
                    <img src="assets/images/cd-home2.png" alt="Vinyl Record"/>
                    <div><a href="#" class="btn-retro">Shop Now</a></div>
                </div>

                <div class="artifactz tapella">
                    <div class="titlemark">Cassettes</div>
                    <div class="cd-container"> 
                        <img src="assets/images/cassette-home.gif" alt="Cassette Tape">
                    </div>
                    <div><a href="#" class="btn-retro">Shop Now</a></div>
                </div>

                <div class="artifactz discara">
                    <div class="titlemark">CDs</div>
                    <img src="assets/images/cd-home1.png" alt="Compact Disc">
                    <div><a href="#" class="btn-retro">Shop Now</a></div>
                </div>
            </div>

            <main class="gallery-container">
                <h2 style="text-align:center;">
                    <span class="home-text">
                        <span class="home-text">
                            <span class="home-text">
                                <span class="home-text">
                                        <span class="home-text">NEW ARRIVALS</span>
                                </span>
                            </span>
                        </span>
                    </span>
                </h2>
            <div class="slider" style="
                --width: 180px; 
                --height:180px;
                --quantity: 10;
            ">
                <div class="list">
                    <div class="item" style="--position: 1"><a href=""><img src="assets/images/Pola Camera/1.jpg" alt=""></a></div>
                    <div class="item" style="--position: 2"><img src="assets/images/Audio/Vinyl/14.png" alt=""></div>
                    <div class="item" style="--position: 3"><img src="assets/images/Cassette Tape/15.png" alt=""></div>
                    <div class="item" style="--position: 4"><img src="assets/images/VHS/6.png" alt=""></div>
                    <div class="item" style="--position: 5"><img src="assets/images/Cassette Tape/1.png" alt=""></div>
                    <div class="item" style="--position: 6"><img src="assets/images/Audio/CDs/6.png" alt=""></div>
                    <div class="item" style="--position: 7"><img src="assets/images/Pola Camera/2.png" alt=""></div>
                    <div class="item" style="--position: 8"><img src="assets/images/VHS/17.png" alt=""></div>
                    <div class="item" style="--position: 9"><img src="assets/images/Cassette Tape/8.png" alt=""></div>
                    <div class="item" style="--position: 10"><img src="assets/images/Audio/CDs/18.png" alt=""></div>
                </div>
            </div>

            <div class="slider slider-offset" style="
                --width: 180px;
                --height: 180px;
                --quantity: 10;
            ">
                <div class="list">
                    <div class="item" style="--position: 1"><img src="assets/images/Cassette Tape/1.png" alt=""></div>
                    <div class="item" style="--position: 2"><img src="assets/images/Accessories/CD Player/1.png" alt=""></div>
                    <div class="item" style="--position: 3"><img src="assets/images/Accessories/IPod/1.png" alt=""></div>
                    <div class="item" style="--position: 4"><img src="assets/images/Accessories/CassettePlayer/16.png" alt=""></div>
                    <div class="item" style="--position: 5"><img src="assets/images/Audio/CDs/19.png" alt=""></div>
                    <div class="item" style="--position: 6"><img src="assets/images/Cassette Tape/19.png" alt=""></div>
                    <div class="item" style="--position: 7"><img src="assets/images/Cassette Tape/15.png" alt=""></div>
                    <div class="item" style="--position: 8"><img src="assets/images/Pola Camera/10.png" alt=""></div>
                    <div class="item" style="--position: 9"><img src="assets/images/Pola Camera/17.png" alt=""></div>
                    <div class="item" style="--position: 10"><img src="assets/images/VHS/20.png" alt=""></div>
                </div>
            </div>
        </main>

            <div class="wrapper">
    <h2 style="text-align:center; color: #c89d41; margin-bottom: 30px; font-family: 'Barlow', sans-serif;">
        BỘ SƯU TẬP ĐẶC BIỆT
    </h2>
    <div class="gallery-grid">
        <div class="gallery-item">
            <img src="assets/images/Pola Camera/1.jpg" alt="Pola Camera">
            <div class="gallery-overlay">
                <h3>Pola Camera</h3>
                <p>Máy ảnh film cổ điển</p>
            </div>
        </div>
        <div class="gallery-item">
            <img src="assets/images/Audio/Vinyl/14.png" alt="Vinyl Record">
            <div class="gallery-overlay">
                <h3>Vinyl Record</h3>
                <p>Đĩa than nguyên bản</p>
            </div>
        </div>
        <div class="gallery-item">
            <img src="assets/images/Cassette Tape/15.png" alt="Cassette Tape">
            <div class="gallery-overlay">
                <h3>Cassette Tape</h3>
                <p>Băng cối vintage</p>
            </div>
        </div>
        <div class="gallery-item">
            <img src="assets/images/VHS/6.png" alt="VHS Tape">
            <div class="gallery-overlay">
                <h3>VHS Tape</h3>
                <p>Băng video cổ điển</p>
            </div>
        </div>
        <div class="gallery-item">
            <img src="assets/images/Accessories/CD Player/1.png" alt="CD Player">
            <div class="gallery-overlay">
                <h3>CD Player</h3>
                <p>Máy nghe nhạc CD</p>
            </div>
        </div>
        <div class="gallery-item">
            <img src="assets/images/Accessories/IPod/1.png" alt="iPod Classic">
            <div class="gallery-overlay">
                <h3>iPod Classic</h3>
                <p>Thiết bị nghe nhạc huyền thoại</p>
            </div>
        </div>
    </div>
</div>
            <div class="footerContainer">
                <div class="socialIcons">
                    <a href=""><i class="fa-brands fa-facebook"></i></a>
                    <a href=""><i class="fa-brands fa-instagram"></i></a>
                    <a href=""><i class="fa-brands fa-twitter"></i></a>
                    <a href=""><i class="fa-brands fa-google-plus"></i></a>
                    <a href=""><i class="fa-brands fa-youtube"></i></a>
                </div>
                <div class="footerNav">
                    <ul>
                        <li><a href="">HOME</a></li>
                        <li><a href="">NEWS</a></li>
                        <li><a href="">PRODUCTS</a></li>
                        <li><a href="">CONTACT US</a></li>
                        <li><a href="">OUR TEAM</a></li>
                    </ul>
                </div>
                <div class="footerBottom">
                    <p>Copyright &copy;2025; Designed by <span class="designer">Nhóm</span></p>
                </div>
            </div>
            <script>
const $ = (s, c = document) => c.querySelector(s);
const $$ = (s, c = document) => Array.from(c.querySelectorAll(s));

const els = {
    grid: $('#productGrid'),
    badge: $('#cartBadge'),
    btn: $('#cartButton'),
    overlay: $('#overlay'),
    modal: $('#cartModal'),
    close: $('#closeModal'),
    list: $('#cartList'),
    empty: $('#emptyState'),
    total: $('#grandTotal'),
    cont: $('#continueLink')
};

const fmt = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND', maximumFractionDigits: 0 });
const state = { items: [] };

const loadingPortal = (() => {
    const root = $('#loadingPortal');
    if (!root) {
        return {
            play: ({ after } = {}) => {
                after?.();
                return Promise.resolve();
            },
            cancel: () => {},
            fastForward: () => {},
            isActive: () => false
        };
    }

    const countdownEl = root.querySelector('[data-countdown]');
    const messageEl = root.querySelector('[data-message]');
    const factEl = root.querySelector('[data-fact]');
    const tipEl = root.querySelector('[data-tip]');
    const progressEl = root.querySelector('[data-progress]');
    const skipBtn = root.querySelector('[data-action="skip"]');
    const vinyl = root.querySelector('[data-fast-forward]');
    const eqBars = Array.from(root.querySelectorAll('[data-eq-bar]'));

    const factGroups = {
        default: [
            'Đang làm ấm đèn âm ly để giữ chất âm chuẩn analog.',
            'Căn chỉnh đầu từ để từng dải tần vang lên chuẩn xác.',
            'Tra dầu bánh răng máy phát để vòng quay mượt hơn.',
            'Tinh chỉnh tiếng rè nền cho đúng vibe retro.'
        ],
        travel: [
            'Đang gấp poster neon để mang sang trang mới.',
            'Chuyển băng qua máy tua nhanh trước khi mở cảnh tiếp theo.',
            'Bật đèn bảng hiệu chào mừng bạn ở không gian kế tiếp.',
            'Xếp cassette vào vali du hành thời gian của Retro Sound.'
        ],
        cart: [
            'Kiểm tra từng cuộn băng trước khi cho vào giỏ của bạn.',
            'Niêm phong tem chống ẩm để bảo vệ âm thanh nguyên bản.',
            'Đo lại độ từ tính để bảo đảm chất lượng thu âm hoàn hảo.',
            'Ghi chú thủ công để bạn không bỏ lỡ câu chuyện của sản phẩm.'
        ]
    };

    let totalMs = 0;
    let elapsedMs = 0;
    let timerId = null;
    let speed = 1;
    let resolver = null;
    let theme = 'default';
    let lastCountdown = 0;

    function pickFact() {
        const pool = factGroups[theme] || factGroups.default;
        return pool[Math.floor(Math.random() * pool.length)];
    }

    function setProgress(value) {
        if (!progressEl) return;
        const safe = Math.min(Math.max(value, 0), 1);
        progressEl.style.setProperty('--progress', safe.toFixed(3));
    }

    function updateEq() {
        if (!eqBars.length) return;
        eqBars.forEach((bar, index) => {
            const base = index % 2 === 0 ? 32 : 26;
            const max = index % 2 === 0 ? 70 : 60;
            const height = base + Math.random() * (max - base);
            bar.style.setProperty('--h', `${height}%`);
        });
    }

    function finish() {
        if (!root.classList.contains('active')) return;
        clearInterval(timerId);
        timerId = null;
        setProgress(1);
        if (countdownEl) countdownEl.textContent = '0';
        if (factEl) factEl.textContent = 'Hoàn tất! Cùng thưởng thức nào.';
        root.classList.remove('active', 'turbo');
        root.setAttribute('aria-hidden', 'true');
        setTimeout(() => {
            setProgress(0);
            updateEq();
            speed = 1;
            elapsedMs = 0;
            lastCountdown = 0;
        }, 320);
        const done = resolver;
        resolver = null;
        done?.();
    }

    function loop() {
        clearInterval(timerId);
        timerId = setInterval(() => {
            elapsedMs += 120 * speed;
            const ratio = Math.min(1, elapsedMs / totalMs);
            setProgress(ratio);
            updateEq();
            const remainingMs = Math.max(0, totalMs - elapsedMs);
            const countdown = Math.max(0, Math.ceil(remainingMs / 1000));
            if (countdown !== lastCountdown) {
                lastCountdown = countdown;
                if (countdownEl) countdownEl.textContent = countdown;
                if (countdown > 0 && factEl) factEl.textContent = pickFact();
            }
            if (ratio >= 1) {
                finish();
            }
        }, 120);
    }

    function play(options = {}) {
        const { seconds = 3, message, factType = 'default', after } = options;
        if (!root) {
            after?.();
            return Promise.resolve();
        }
        theme = factGroups[factType] ? factType : 'default';
        totalMs = Math.max(1600, seconds * 1000);
        elapsedMs = 0;
        speed = 1;
        lastCountdown = Math.ceil(totalMs / 1000);
        if (countdownEl) countdownEl.textContent = lastCountdown;
        if (messageEl) messageEl.textContent = message || 'Đang xử lý yêu cầu...';
        if (factEl) factEl.textContent = pickFact();
        if (tipEl) tipEl.textContent = 'Nhấn phím F để tua nhanh hoặc chạm vào đĩa vinyl phát sáng.';
        root.classList.remove('turbo');
        root.classList.add('active');
        root.setAttribute('aria-hidden', 'false');
        updateEq();
        setProgress(0);

        return new Promise((resolve) => {
            resolver = () => {
                after?.();
                resolve();
            };
            loop();
        });
    }

    function fastForward() {
        if (!root.classList.contains('active')) return;
        speed = Math.min(speed + 1.5, 6);
        root.classList.add('turbo');
        if (messageEl) messageEl.textContent = `Chế độ tua nhanh x${speed.toFixed(1)}`;
        if (factEl) factEl.textContent = 'Băng từ đang quay vun vút!';
        if (tipEl) tipEl.textContent = 'Nhấn ESC để bỏ qua hoặc giữ F để tăng tốc.';
    }

    function cancel() {
        if (!root.classList.contains('active')) return;
        if (factEl) factEl.textContent = 'Đã bỏ qua hiệu ứng.';
        finish();
    }

    skipBtn?.addEventListener('click', (event) => {
        event.preventDefault();
        cancel();
    });

    vinyl?.addEventListener('click', (event) => {
        event.preventDefault();
        fastForward();
    });

    document.addEventListener('keydown', (event) => {
        if (!root.classList.contains('active')) return;
        const key = event.key.toLowerCase();
        if (key === 'f') {
            event.preventDefault();
            fastForward();
        }
        if (key === 'escape') {
            event.preventDefault();
            cancel();
        }
    });

    root.addEventListener('pointermove', () => {
        if (root.classList.contains('active')) updateEq();
    });

    return {
        play,
        cancel,
        fastForward,
        isActive: () => root.classList.contains('active')
    };
})();

function openModal() {
    if (!els.overlay || !els.modal || !els.btn || !els.close) return;
    els.overlay.classList.add('show');
    els.modal.classList.add('show');
    els.btn.setAttribute('aria-expanded', 'true');
    setTimeout(() => els.close?.focus(), 0);
}

function closeModal() {
    if (!els.overlay || !els.modal || !els.btn) return;
    els.overlay.classList.remove('show');
    els.modal.classList.remove('show');
    els.btn.setAttribute('aria-expanded', 'false');
    els.btn.focus();
}

function updateBadge() {
    if (!els.badge) return;
    const n = state.items.reduce((sum, item) => sum + item.qty, 0);
    els.badge.textContent = n;
    els.badge.classList.toggle('show', n > 0);
}

function render() {
    if (!els.list || !els.total) return;
    els.list.innerHTML = '';
    if (state.items.length === 0) {
        if (els.empty) {
            els.empty.style.display = 'block';
            els.list.appendChild(els.empty);
        }
    } else {
        if (els.empty) els.empty.style.display = 'none';
        state.items.forEach((it) => {
            const row = document.createElement('div');
            row.className = 'line';
            row.innerHTML = `
                <img src="${it.img}" alt="${it.name}" width="72" height="72" style="border-radius:8px; object-fit:cover">
                <div>
                    <h4>${it.name}</h4>
                    <div class="muted-sm">${fmt.format(it.price)}</div>
                    <button class="remove" data-id="${it.id}">Xóa</button>
                </div>
                <div style="display:grid; gap:6px; justify-items:end">
                    <div class="qty" role="group" aria-label="Số lượng">
                        <button class="dec" data-id="${it.id}" aria-label="Giảm">−</button>
                        <input type="text" inputmode="numeric" value="${it.qty}" aria-label="Số lượng hiện tại">
                        <button class="inc" data-id="${it.id}" aria-label="Tăng">+</button>
                    </div>
                    <div class="line-total">${fmt.format(it.price * it.qty)}</div>
                </div>
            `;
            els.list.appendChild(row);
        });
    }
    const total = state.items.reduce((sum, item) => sum + item.price * item.qty, 0);
    els.total.textContent = fmt.format(total);
    updateBadge();
}

function add(prod) {
    const productName = prod.name || 'sản phẩm';
    loadingPortal.play({
        seconds: 3.2,
        message: `Đang tua băng để thêm “${productName}” vào giỏ...`,
        factType: 'cart',
        after: () => {
            const existing = state.items.find((item) => item.id === prod.id);
            if (existing) existing.qty += 1;
            else state.items.push({ ...prod, qty: 1 });
            render();
            openModal();
        }
    });
}

function setQty(id, qty) {
    const item = state.items.find((it) => it.id === id);
    if (!item) return;
    item.qty = Math.max(1, Math.min(999, Number(qty) || 1));
    render();
}

function removeItem(id) {
    state.items = state.items.filter((it) => it.id !== id);
    render();
}

const loadingLinks = [
    ...$$('.nav-menu > li > a.nav-link'),
    ...$$('.nav-menu .submenu-link'),
    ...$$('.header-icons a'),
    ...$$('.footerNav a'),
    ...$$('.socialIcons a'),
    $('.story .text-link')
].filter(Boolean);

loadingLinks.forEach((link) => {
    link.dataset.loadingTrigger = 'true';
    if (!link.dataset.loadingMessage) {
        const label = link.textContent?.trim();
        link.dataset.loadingMessage = label ? `Đang chuẩn bị "${label}"...` : 'Đang chuyển trang...';
    }
    link.dataset.loadingSeconds = link.dataset.loadingSeconds || (link.classList.contains('text-link') ? '2.4' : '2.8');
    link.dataset.loadingTheme = link.dataset.loadingTheme || 'travel';
});

document.addEventListener('click', (event) => {
    const trigger = event.target.closest('[data-loading-trigger]');
    if (!trigger) return;
    if (trigger.dataset.loadingDisabled === 'true') return;
    const href = trigger.getAttribute('href');
    const seconds = parseFloat(trigger.dataset.loadingSeconds) || 2.6;
    const message = trigger.dataset.loadingMessage || 'Đang chuyển trang...';
    const factType = trigger.dataset.loadingTheme || 'travel';

    if (!href || href === '#') {
        event.preventDefault();
        loadingPortal.play({ seconds, message, factType });
        return;
    }

    event.preventDefault();
    loadingPortal.play({
        seconds,
        message,
        factType,
        after: () => {
            window.location.href = href;
        }
    });
});

els.grid?.addEventListener('click', (event) => {
    const btn = event.target.closest('.add');
    if (!btn) return;
    const item = event.target.closest('.item');
    if (!item) return;

    const rawPrice = item.dataset.price ? parseFloat(item.dataset.price.replace(/[^0-9.]/g, '')) : 90;
    const price = Math.round(rawPrice * 23000);
    const img = item.dataset.img || item.querySelector('img.main-image')?.src;
    const fallbackId = item.dataset.id || item.id || item.dataset.name || img || `sku-${Date.now()}`;

    add({
        id: String(fallbackId),
        name: item.dataset.name || item.querySelector('h4')?.textContent?.trim() || 'Sản phẩm',
        price,
        img
    });
});

els.btn?.addEventListener('click', () => {
    if (!loadingPortal.isActive()) openModal();
});

els.overlay?.addEventListener('click', closeModal);
els.close?.addEventListener('click', closeModal);
els.cont?.addEventListener('click', (event) => {
    event.preventDefault();
    if (!loadingPortal.isActive()) closeModal();
});

document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape' && !loadingPortal.isActive()) {
        closeModal();
    }
});

els.list?.addEventListener('click', (event) => {
    const target = event.target;
    if (target.classList.contains('inc')) setQty(target.dataset.id, (state.items.find((i) => i.id === target.dataset.id)?.qty || 1) + 1);
    if (target.classList.contains('dec')) setQty(target.dataset.id, (state.items.find((i) => i.id === target.dataset.id)?.qty || 1) - 1);
    if (target.classList.contains('remove')) removeItem(target.dataset.id);
});

els.list?.addEventListener('input', (event) => {
    const input = event.target;
    if (input.tagName !== 'INPUT') return;
    const row = input.closest('.line');
    if (!row) return;
    const id = row.querySelector('.inc')?.dataset.id;
    if (!id) return;
    const newQty = input.value.replace(/\D/g, '');
    setQty(id, newQty);
});

render();

            </script>
            </body>
    </html>