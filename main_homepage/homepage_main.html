<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,100..900;1,100..900&family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    >
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="homepage_main.css">
    <title>Retro Sound — Trang chủ</title>
  </head>
  <body>
    <header class="site-header">
      <nav class="navbar section-content" aria-label="Điều hướng chính">
        <div class="header-bar">
          <a href="#" class="nav-logo">
            <img src="../assets/images/shopname.jpg" alt="Retro Queue" width="150" height="60">
          </a>
          <div class="header-actions">
            <button type="button" class="icon-btn" aria-label="Tài khoản">
              <i class="fa-regular fa-user"></i>
            </button>
            <button
              type="button"
              class="icon-btn"
              aria-expanded="false"
              aria-controls="headerSearchPanel"
              data-action="toggle-search"
              aria-label="Mở tìm kiếm"
            >
              <i class="fa-solid fa-magnifying-glass"></i>
            </button>
            <button
              type="button"
              class="icon-btn cart-btn"
              id="cartButton"
              aria-expanded="false"
              aria-controls="cartModal"
              title="Giỏ hàng"
            >
              <span class="sr-only">Mở giỏ hàng</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6 6h15l-1.5 9h-12L5 2H2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                <circle cx="9" cy="21" r="1.8" fill="currentColor"></circle>
                <circle cx="18" cy="21" r="1.8" fill="currentColor"></circle>
              </svg>
              <span class="badge" id="cartBadge"></span>
            </button>
          </div>
        </div>
        <div class="nav-menu-wrapper">
          <ul class="nav-menu">
            <li class="nav-item">
              <a href="#" class="nav-link">Audio</a>
              <ul class="submenu">
                <li><a href="#" class="submenu-link">CD</a></li>
                <li><a href="#" class="submenu-link">Vinyl</a></li>
              </ul>
            </li>
            <li class="nav-item"><a href="#" class="nav-link">VHS</a></li>
            <li class="nav-item"><a href="#" class="nav-link">Cassette Tape</a></li>
            <li class="nav-item"><a href="#" class="nav-link">Pola Camera</a></li>
            <li class="nav-item">
              <a href="#" class="nav-link">Accessories</a>
              <ul class="submenu">
                <li><a href="#" class="submenu-link">Cassette Player</a></li>
                <li><a href="#" class="submenu-link">iPod</a></li>
                <li><a href="#" class="submenu-link">CD Player</a></li>
              </ul>
            </li>
            <li class="nav-item"><a href="#" class="nav-link">Cine Room</a></li>
            <li class="nav-item"><a href="#" class="nav-link">Thread</a></li>
          </ul>
        </div>
        <div class="header-search-panel" id="headerSearchPanel" aria-hidden="true">
          <form class="header-search-form" role="search">
            <label class="sr-only" for="headerSearchInput">Tìm kiếm sản phẩm</label>
            <input id="headerSearchInput" class="header-search-input" type="search" name="q" placeholder="Tìm vinyl, cassette, máy ảnh..." autocomplete="off">
            <button type="submit" class="btn search-submit">Tìm kiếm</button>
          </form>
          <div class="search-hints">
            <p class="hints-title">Gợi ý nhanh</p>
            <ul class="hint-list">
              <li><button type="button" class="hint-pill" data-term="Vinyl giới hạn">Vinyl giới hạn</button></li>
              <li><button type="button" class="hint-pill" data-term="Máy ảnh Polaroid">Máy ảnh Polaroid</button></li>
              <li><button type="button" class="hint-pill" data-term="Cassette Sony">Cassette Sony</button></li>
              <li><button type="button" class="hint-pill" data-term="Âm ly đèn">Âm ly đèn</button></li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <main class="page-main">
      <section class="hero-section" aria-labelledby="heroTitle">
        <div class="hero-media">
          <img src="../assets/images/main-banner.jpg" alt="Retro Sound main banner" class="hero-image">
          <div class="hero-overlay"></div>
        </div>
        <div class="hero-content">
          <p class="eyebrow">Âm thanh cổ điển cho thế hệ mới</p>
          <h1 id="heroTitle">Khám phá kho báu Retro Sound</h1>
          <p class="hero-description">
            Từ vinyl nguyên bản, máy ảnh pola cho đến cassette hiếm – tất cả được tuyển chọn để giúp bạn sống lại kỷ nguyên vàng của âm nhạc và điện ảnh.
          </p>
          <div class="hero-actions">
            <a href="#" class="btn btn-primary">Khám phá ngay</a>
            <a href="#" class="btn btn-ghost">Xem bộ sưu tập</a>
          </div>
        </div>
      </section>

      <section class="product-banner" aria-label="Bộ banner sản phẩm nổi bật">
        <div class="grid-layout">
          <div class="banner banner-large">
            <img src="../assets/images/Banner1.jpg" alt="Bộ sưu tập Vinyl huyền thoại">
          </div>
          <div class="banner-column">
            <div class="banner">
              <img src="../assets/images/Banner2.jpg" alt="Máy ảnh Polaroid retro">
            </div>
            <div class="banner">
              <img src="../assets/images/Banner3.jpg" alt="Phụ kiện audio vintage">
            </div>
          </div>
        </div>
      </section>

      <section class="story" aria-labelledby="storyTitle">
        <div class="story-inner">
          <div class="story-copy">
            <p class="eyebrow">Retro Sound Studio</p>
            <h2 id="storyTitle">Cảm hứng từ những phòng thu thập niên 80</h2>
            <p>
              Chúng tôi săn tìm từng cuộn băng, từng chiếc máy ảnh cũ trên khắp thế giới, phục chế bằng tay và kiểm tra thủ công trước khi đưa đến tay bạn. Bộ sưu tập tại Retro Sound được tuyển chọn bởi những người yêu âm nhạc và nghệ thuật analog, để mỗi sản phẩm đều mang câu chuyện riêng.
            </p>
            <a href="#" class="text-link">Tìm hiểu thêm về hành trình của chúng tôi</a>
          </div>
          <div class="story-visual">
            <figure class="story-card">
              <img src="../assets/images/Vinyl_collection.gif" alt="Cassette collection">
              <figcaption class="sr-only">Hình ảnh bộ sưu tập vinyl cổ điển</figcaption>
            </figure>
            <div class="story-stats">
              <div>
                <span class="stat-number">250+</span>
                <span class="stat-label">Bản thu giới hạn</span>
              </div>
              <div>
                <span class="stat-number">50</span>
                <span class="stat-label">Máy ảnh pola phục chế</span>
              </div>
              <div>
                <span class="stat-number">30</span>
                <span class="stat-label">Sự kiện nghe thử mỗi năm</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="best-seller-arena" aria-labelledby="bestSellerTitle">
        <div class="section-header">
          <p class="eyebrow">Retro Sound Picks</p>
          <h2 id="bestSellerTitle">Best Sellers</h2>
        </div>
        <div class="grid" id="productGrid">
          <div class="box">
            <div class="item" id="sku-1" data-name="VHS 13" data-price="$90.00" data-img="../assets/images/VHS/13.jpg">
              <div class="thumb">
                <div class="hover-content">
                  <ul>
                    <li><a href="#" aria-label="Yêu thích VHS 13"><i class="fa-regular fa-heart"></i></a></li>
                    <li><button class="btn add" type="button" aria-label="Thêm VHS 13 vào giỏ"><i class="fa-solid fa-bag-shopping"></i></button></li>
                  </ul>
                </div>
                <img src="../assets/images/VHS/13.jpg" alt="VHS 13" class="main-image">
                <img src="../assets/images/VHS/14.jpg" alt="VHS 13 hover" class="hover-image">
              </div>
              <div class="down-content">
                <h3>VHS 13</h3>
                <div class="product-price">
                  <span class="current">$90.00</span>
                </div>
              </div>
            </div>
          </div>
          <div class="box">
            <div class="item" data-id="sku-2" data-name="Audio Vinyl 13" data-price="$90.00" data-img="../assets/images/Audio/Vinyl/13.jpg">
              <div class="thumb">
                <div class="hover-content">
                  <ul>
                    <li><a href="#" aria-label="Yêu thích Audio Vinyl 13"><i class="fa-regular fa-heart"></i></a></li>
                    <li><button class="btn add" type="button" aria-label="Thêm Audio Vinyl 13 vào giỏ"><i class="fa-solid fa-bag-shopping"></i></button></li>
                  </ul>
                </div>
                <img src="../assets/images/Audio/Vinyl/13.jpg" alt="Audio Vinyl 13" class="main-image">
                <img src="../assets/images/Audio/Vinyl/14.jpg" alt="Audio Vinyl 13 hover" class="hover-image">
              </div>
              <div class="down-content">
                <h3>Audio Vinyl 13</h3>
                <div class="product-price">
                  <span class="current">$90.00</span>
                </div>
              </div>
            </div>
          </div>
          <div class="box">
            <div class="item" data-id="sku-3" data-name="Cassette Tape 17" data-price="$90.00" data-img="../assets/images/Cassette Tape/17.jpg">
              <div class="thumb">
                <div class="hover-content">
                  <ul>
                    <li><a href="#" aria-label="Yêu thích Cassette Tape 17"><i class="fa-regular fa-heart"></i></a></li>
                    <li><button class="btn add" type="button" aria-label="Thêm Cassette Tape 17 vào giỏ"><i class="fa-solid fa-bag-shopping"></i></button></li>
                  </ul>
                </div>
                <img src="../assets/images/Cassette Tape/17.jpg" alt="Cassette Tape 17" class="main-image">
                <img src="../assets/images/Cassette Tape/18.jpg" alt="Cassette Tape 17 hover" class="hover-image">
              </div>
              <div class="down-content">
                <h3>Cassette Tape 17</h3>
                <div class="product-price">
                  <span class="current">$90.00</span>
                </div>
              </div>
            </div>
          </div>
          <div class="box">
            <div class="item" data-id="sku-4" data-name="Pola Camera 11" data-price="$90.00" data-img="../assets/images/Pola Camera/11.jpg">
              <div class="thumb">
                <div class="hover-content">
                  <ul>
                    <li><a href="#" aria-label="Yêu thích Pola Camera 11"><i class="fa-regular fa-heart"></i></a></li>
                    <li><button class="btn add" type="button" aria-label="Thêm Pola Camera 11 vào giỏ"><i class="fa-solid fa-bag-shopping"></i></button></li>
                  </ul>
                </div>
                <img src="../assets/images/Pola Camera/11.jpg" alt="Pola Camera 11" class="main-image">
                <img src="../assets/images/Pola Camera/12.jpg" alt="Pola Camera 11 hover" class="hover-image">
              </div>
              <div class="down-content">
                <h3>Pola Camera 11</h3>
                <div class="product-price">
                  <span class="current">$90.00</span>
                </div>
              </div>
            </div>
          </div>
          <div class="box">
            <div class="item" data-id="sku-5" data-name="iPod 8" data-price="$90.00" data-img="../assets/images/Accessories/IPod/8.jpg">
              <div class="thumb">
                <div class="hover-content">
                  <ul>
                    <li><a href="#" aria-label="Yêu thích iPod 8"><i class="fa-regular fa-heart"></i></a></li>
                    <li><button class="btn add" type="button" aria-label="Thêm iPod 8 vào giỏ"><i class="fa-solid fa-bag-shopping"></i></button></li>
                  </ul>
                </div>
                <img src="../assets/images/Accessories/IPod/8.jpg" alt="iPod 8" class="main-image">
                <img src="../assets/images/Accessories/IPod/9.jpg" alt="iPod 8 hover" class="hover-image">
              </div>
              <div class="down-content">
                <h3>iPod 8</h3>
                <div class="product-price">
                  <span class="current">$90.00</span>
                </div>
              </div>
            </div>
          </div>
          <div class="box">
            <div class="item" data-id="sku-6" data-name="CD Player 13" data-price="$90.00" data-img="../assets/images/Accessories/CD Player/13.jpg">
              <div class="thumb">
                <div class="hover-content">
                  <ul>
                    <li><a href="#" aria-label="Yêu thích CD Player 13"><i class="fa-regular fa-heart"></i></a></li>
                    <li><button class="btn add" type="button" aria-label="Thêm CD Player 13 vào giỏ"><i class="fa-solid fa-bag-shopping"></i></button></li>
                  </ul>
                </div>
                <img src="../assets/images/Accessories/CD Player/13.jpg" alt="CD Player 13" class="main-image">
                <img src="../assets/images/Accessories/CD Player/14.jpg" alt="CD Player 13 hover" class="hover-image">
              </div>
              <div class="down-content">
                <h3>CD Player 13</h3>
                <div class="product-price">
                  <span class="current">$90.00</span>
                </div>
              </div>
            </div>
          </div>
          <div class="box">
            <div class="item" data-id="sku-7" data-name="Pola Camera 15" data-price="$90.00" data-img="../assets/images/Pola Camera/15.jpg">
              <div class="thumb">
                <div class="hover-content">
                  <ul>
                    <li><a href="#" aria-label="Yêu thích Pola Camera 15"><i class="fa-regular fa-heart"></i></a></li>
                    <li><button class="btn add" type="button" aria-label="Thêm Pola Camera 15 vào giỏ"><i class="fa-solid fa-bag-shopping"></i></button></li>
                  </ul>
                </div>
                <img src="../assets/images/Pola Camera/15.jpg" alt="Pola Camera 15" class="main-image">
                <img src="../assets/images/Pola Camera/16.jpg" alt="Pola Camera 15 hover" class="hover-image">
              </div>
              <div class="down-content">
                <h3>Pola Camera 15</h3>
                <div class="product-price">
                  <span class="current">$90.00</span>
                </div>
              </div>
            </div>
          </div>
          <div class="box">
            <div class="item" data-id="sku-8" data-name="Audio Vinyl 14" data-price="$90.00" data-img="../assets/images/Audio/Vinyl/14.jpg">
              <div class="thumb">
                <div class="hover-content">
                  <ul>
                    <li><a href="#" aria-label="Yêu thích Audio Vinyl 14"><i class="fa-regular fa-heart"></i></a></li>
                    <li><button class="btn add" type="button" aria-label="Thêm Audio Vinyl 14 vào giỏ"><i class="fa-solid fa-bag-shopping"></i></button></li>
                  </ul>
                </div>
                <img src="../assets/images/Audio/Vinyl/14.jpg" alt="Audio Vinyl 14" class="main-image">
                <img src="../assets/images/Audio/Vinyl/15.jpg" alt="Audio Vinyl 14 hover" class="hover-image">
              </div>
              <div class="down-content">
                <h3>Audio Vinyl 14</h3>
                <div class="product-price">
                  <span class="current">$90.00</span>
                </div>
              </div>
            </div>
          </div>
          <div class="box">
            <div class="item" data-id="sku-9" data-name="VHS 39" data-price="$90.00" data-img="../assets/images/VHS/39.jpg">
              <div class="thumb">
                <div class="hover-content">
                  <ul>
                    <li><a href="#" aria-label="Yêu thích VHS 39"><i class="fa-regular fa-heart"></i></a></li>
                    <li><button class="btn add" type="button" aria-label="Thêm VHS 39 vào giỏ"><i class="fa-solid fa-bag-shopping"></i></button></li>
                  </ul>
                </div>
                <img src="../assets/images/VHS/39.jpg" alt="VHS 39" class="main-image">
                <img src="../assets/images/VHS/40.jpg" alt="VHS 39 hover" class="hover-image">
              </div>
              <div class="down-content">
                <h3>VHS 39</h3>
                <div class="product-price">
                  <span class="current">$90.00</span>
                </div>
              </div>
            </div>
          </div>
          <div class="box">
            <div class="item" data-id="sku-10" data-name="VHS 13" data-price="$90.00" data-img="../assets/images/VHS/13.jpg">
              <div class="thumb">
                <div class="hover-content">
                  <ul>
                    <li><a href="#" aria-label="Yêu thích VHS 13"><i class="fa-regular fa-heart"></i></a></li>
                    <li><button class="btn add" type="button" aria-label="Thêm VHS 13 vào giỏ"><i class="fa-solid fa-bag-shopping"></i></button></li>
                  </ul>
                </div>
                <img src="../assets/images/VHS/13.jpg" alt="VHS 13" class="main-image">
                <img src="../assets/images/VHS/14.jpg" alt="VHS 13 hover" class="hover-image">
              </div>
              <div class="down-content">
                <h3>VHS 13</h3>
                <div class="product-price">
                  <span class="current">$90.00</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="overlay" id="overlay" tabindex="-1" aria-hidden="true"></div>
      <section class="modal" id="cartModal" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
        <div class="modal-head">
          <div id="cartTitle" class="modal-title">Giỏ hàng</div>
          <button class="x" id="closeModal" aria-label="Đóng"></button>
        </div>
        <div class="modal-body" id="cartList">
          <div class="empty" id="emptyState">Chưa có sản phẩm.</div>
        </div>
        <div class="modal-foot">
          <div class="sum"><span>Tổng</span><span id="grandTotal">0₫</span></div>
          <div class="actions">
            <button class="btn secondary" type="button">Giỏ hàng</button>
            <button class="btn" type="button">Thanh toán</button>
          </div>
          <a href="#" class="continue" id="continueLink">Tiếp tục mua hàng</a>
        </div>
      </section>

      <section class="vaultzone" aria-label="Danh mục chính">
        <article class="artifactz vinora">
          <h3 class="titlemark">Vinyl</h3>
          <img src="../assets/images/cd-home2.png" alt="Vinyl Record">
          <div><a href="#" class="btn btn-secondary">Shop Now</a></div>
        </article>
        <article class="artifactz tapella">
          <h3 class="titlemark">Cassettes</h3>
          <div class="cd-container">
            <img src="../assets/images/cassette-home.gif" alt="Cassette Tape">
          </div>
          <div><a href="#" class="btn btn-secondary">Shop Now</a></div>
        </article>
        <article class="artifactz discara">
          <h3 class="titlemark">CDs</h3>
          <img src="../assets/images/cd-home1.png" alt="Compact Disc">
          <div><a href="#" class="btn btn-secondary">Shop Now</a></div>
        </article>
      </section>

      <section class="gallery-container" aria-labelledby="newArrivalsTitle">
        <div class="section-header">
          <p class="eyebrow">Retro Sound Picks</p>
          <h2 id="newArrivalsTitle">New Arrivals</h2>
        </div>
        <div class="slider" style="--width: 180px; --height: 180px; --quantity: 10;">
          <div class="list">
            <div class="item" style="--position: 1"><a href="#"><img src="../assets/images/Pola Camera/1.jpg" alt="Pola Camera 1"></a></div>
            <div class="item" style="--position: 2"><img src="../assets/images/Audio/Vinyl/14.jpg" alt="Vinyl 14"></div>
            <div class="item" style="--position: 3"><img src="../assets/images/Cassette Tape/15.jpg" alt="Cassette 15"></div>
            <div class="item" style="--position: 4"><img src="../assets/images/VHS/6.jpg" alt="VHS 6"></div>
            <div class="item" style="--position: 5"><img src="../assets/images/Cassette Tape/1.jpg" alt="Cassette 1"></div>
            <div class="item" style="--position: 6"><img src="../assets/images/Audio/CDs/6.jpg" alt="CD 6"></div>
            <div class="item" style="--position: 7"><img src="../assets/images/Pola Camera/2.jpg" alt="Pola Camera 2"></div>
            <div class="item" style="--position: 8"><img src="../assets/images/VHS/17.jpg" alt="VHS 17"></div>
            <div class="item" style="--position: 9"><img src="../assets/images/Cassette Tape/8.jpg" alt="Cassette 8"></div>
            <div class="item" style="--position: 10"><img src="../assets/images/Audio/CDs/18.jpg" alt="CD 18"></div>
          </div>
        </div>
        <div class="slider slider-offset" style="--width: 180px; --height: 180px; --quantity: 10;">
          <div class="list">
            <div class="item" style="--position: 1"><img src="../assets/images/Cassette Tape/1.jpg" alt="Cassette 1"></div>
            <div class="item" style="--position: 2"><img src="../assets/images/Accessories/CD Player/1.jpg" alt="CD Player 1"></div>
            <div class="item" style="--position: 3"><img src="../assets/images/Accessories/IPod/1.jpg" alt="iPod 1"></div>
            <div class="item" style="--position: 4"><img src="../assets/images/Accessories/CassettePlayer/16.jpg" alt="Cassette Player 16"></div>
            <div class="item" style="--position: 5"><img src="../assets/images/Audio/CDs/19.jpg" alt="CD 19"></div>
            <div class="item" style="--position: 6"><img src="../assets/images/Cassette Tape/19.jpg" alt="Cassette 19"></div>
            <div class="item" style="--position: 7"><img src="../assets/images/Cassette Tape/15.jpg" alt="Cassette 15"></div>
            <div class="item" style="--position: 8"><img src="../assets/images/Pola Camera/10.jpg" alt="Pola Camera 10"></div>
            <div class="item" style="--position: 9"><img src="../assets/images/Pola Camera/17.jpg" alt="Pola Camera 17"></div>
            <div class="item" style="--position: 10"><img src="../assets/images/VHS/20.jpg" alt="VHS 20"></div>
          </div>
        </div>
      </section>
    </main>

    <div class="wrapper">
      <div class="footer-gallery">
        <input type="radio" name="slide" id="c1" checked>
        <label for="c1" class="card"></label>
        <input type="radio" name="slide" id="c2">
        <label for="c2" class="card"></label>
        <input type="radio" name="slide" id="c3">
        <label for="c3" class="card"></label>
        <input type="radio" name="slide" id="c4">
        <label for="c4" class="card"></label>
        <input type="radio" name="slide" id="c5">
        <label for="c5" class="card"></label>
      </div>
    </div>

    <footer class="footerContainer">
      <div class="socialIcons">
        <a href="#" aria-label="Facebook"><i class="fa-brands fa-facebook"></i></a>
        <a href="#" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
        <a href="#" aria-label="Twitter"><i class="fa-brands fa-x-twitter"></i></a>
        <a href="#" aria-label="Google Plus"><i class="fa-brands fa-google-plus"></i></a>
        <a href="#" aria-label="YouTube"><i class="fa-brands fa-youtube"></i></a>
      </div>
      <nav class="footerNav" aria-label="Liên kết chân trang">
        <ul>
          <li><a href="#">Home</a></li>
          <li><a href="#">News</a></li>
          <li><a href="#">Products</a></li>
          <li><a href="#">Contact</a></li>
          <li><a href="#">Our Team</a></li>
        </ul>
      </nav>
      <div class="footerBottom">
        <p>Copyright &copy;2025; Designed by <span class="designer">Nhóm</span></p>
      </div>
    </footer>

    <script>
      const $ = (selector, context = document) => context.querySelector(selector);
      const $$ = (selector, context = document) => Array.from(context.querySelectorAll(selector));

      const els = {
        grid: $('#productGrid'),
        badge: $('#cartBadge'),
        btn: $('#cartButton'),
        overlay: $('#overlay'),
        modal: $('#cartModal'),
        close: $('#closeModal'),
        list: $('#cartList'),
        empty: $('#emptyState'),
        total: $('#grandTotal'),
        cont: $('#continueLink'),
        searchPanel: $('#headerSearchPanel'),
        searchToggle: document.querySelector('[data-action="toggle-search"]'),
        searchInput: $('#headerSearchInput'),
        searchForm: $('.header-search-form')
      };

      const fmt = new Intl.NumberFormat('vi-VN', {
        style: 'currency',
        currency: 'VND',
        maximumFractionDigits: 0
      });

      const state = { items: [] };

      function openModal() {
        if (!els.overlay || !els.modal || !els.btn || !els.close) return;
        els.overlay.classList.add('show');
        els.modal.classList.add('show');
        els.modal.setAttribute('aria-hidden', 'false');
        els.btn.setAttribute('aria-expanded', 'true');
        setTimeout(() => els.close?.focus(), 0);
      }

      function closeModal() {
        if (!els.overlay || !els.modal || !els.btn) return;
        els.overlay.classList.remove('show');
        els.modal.classList.remove('show');
        els.modal.setAttribute('aria-hidden', 'true');
        els.btn.setAttribute('aria-expanded', 'false');
        els.btn.focus();
      }

      function updateBadge() {
        if (!els.badge) return;
        const n = state.items.reduce((sum, item) => sum + item.qty, 0);
        els.badge.textContent = n;
        els.badge.classList.toggle('show', n > 0);
      }

      function render() {
        if (!els.list || !els.total) return;
        els.list.innerHTML = '';
        if (state.items.length === 0) {
          if (els.empty) {
            els.empty.style.display = 'block';
            els.list.appendChild(els.empty);
          }
        } else {
          if (els.empty) els.empty.style.display = 'none';
          state.items.forEach((it) => {
            const row = document.createElement('div');
            row.className = 'line';
            row.innerHTML = `
              <img src="${it.img}" alt="${it.name}" width="72" height="72" style="border-radius:8px; object-fit:cover">
              <div>
                <h4>${it.name}</h4>
                <div class="muted-sm">${fmt.format(it.price)}</div>
                <button class="remove" data-id="${it.id}">Xóa</button>
              </div>
              <div class="line-controls">
                <div class="qty" role="group" aria-label="Số lượng">
                  <button class="dec" data-id="${it.id}" aria-label="Giảm">−</button>
                  <input type="text" inputmode="numeric" value="${it.qty}" aria-label="Số lượng hiện tại">
                  <button class="inc" data-id="${it.id}" aria-label="Tăng">+</button>
                </div>
                <div class="line-total">${fmt.format(it.price * it.qty)}</div>
              </div>
            `;
            els.list.appendChild(row);
          });
        }
        const total = state.items.reduce((sum, item) => sum + item.price * item.qty, 0);
        els.total.textContent = fmt.format(total);
        updateBadge();
      }

      function add(prod) {
        const existing = state.items.find((item) => item.id === prod.id);
        if (existing) existing.qty += 1;
        else state.items.push({ ...prod, qty: 1 });
        render();
        openModal();
      }

      function setQty(id, qty) {
        const item = state.items.find((it) => it.id === id);
        if (!item) return;
        item.qty = Math.max(1, Math.min(999, Number(qty) || 1));
        render();
      }

      function removeItem(id) {
        state.items = state.items.filter((it) => it.id !== id);
        render();
      }

      function toggleSearch(force) {
        if (!els.searchPanel) return;
        const shouldOpen = typeof force === 'boolean'
          ? force
          : !els.searchPanel.classList.contains('show');
        els.searchPanel.classList.toggle('show', shouldOpen);
        els.searchPanel.setAttribute('aria-hidden', shouldOpen ? 'false' : 'true');
        els.searchToggle?.setAttribute('aria-expanded', shouldOpen ? 'true' : 'false');
        if (shouldOpen) {
          els.searchPanel.removeAttribute('hidden');
          setTimeout(() => els.searchInput?.focus(), 0);
        } else {
          els.searchPanel.setAttribute('hidden', '');
        }
      }

      els.grid?.addEventListener('click', (event) => {
        const btn = event.target.closest('.add');
        if (!btn) return;
        const item = event.target.closest('.item');
        if (!item) return;

        const rawPrice = item.dataset.price ? parseFloat(item.dataset.price.replace(/[^0-9.]/g, '')) : 90;
        const price = Math.round(rawPrice * 23000);
        const img = item.dataset.img || item.querySelector('img.main-image')?.src || '';
        const fallbackId = item.dataset.id || item.id || item.dataset.name || img || `sku-${Date.now()}`;

        add({
          id: String(fallbackId),
          name: item.dataset.name || item.querySelector('h3, h4')?.textContent?.trim() || 'Sản phẩm',
          price,
          img
        });
      });

      els.btn?.addEventListener('click', () => {
        openModal();
      });

      els.overlay?.addEventListener('click', closeModal);
      els.close?.addEventListener('click', closeModal);
      els.cont?.addEventListener('click', (event) => {
        event.preventDefault();
        closeModal();
      });

      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          if (els.modal?.classList.contains('show')) closeModal();
          if (els.searchPanel?.classList.contains('show')) toggleSearch(false);
        }
      });

      els.list?.addEventListener('click', (event) => {
        const target = event.target;
        if (target.classList.contains('inc')) setQty(target.dataset.id, (state.items.find((i) => i.id === target.dataset.id)?.qty || 1) + 1);
        if (target.classList.contains('dec')) setQty(target.dataset.id, (state.items.find((i) => i.id === target.dataset.id)?.qty || 1) - 1);
        if (target.classList.contains('remove')) removeItem(target.dataset.id);
      });

      els.list?.addEventListener('input', (event) => {
        const input = event.target;
        if (!(input instanceof HTMLInputElement)) return;
        const row = input.closest('.line');
        if (!row) return;
        const id = row.querySelector('.inc')?.dataset.id;
        if (!id) return;
        const newQty = input.value.replace(/\D/g, '');
        setQty(id, newQty);
      });

      els.searchToggle?.addEventListener('click', () => {
        toggleSearch();
      });

      document.addEventListener('click', (event) => {
        if (!els.searchPanel?.classList.contains('show')) return;
        if (event.target.closest('.header-search-panel') || event.target.closest('[data-action="toggle-search"]')) return;
        toggleSearch(false);
      });

      els.searchForm?.addEventListener('submit', (event) => {
        event.preventDefault();
        if (!els.searchInput) return;
        const query = els.searchInput.value.trim();
        if (!query) {
          els.searchInput.focus();
          return;
        }
        alert(`Tìm kiếm: ${query}`);
      });

      $$('.hint-pill').forEach((btn) => {
        btn.addEventListener('click', () => {
          if (!els.searchInput) return;
          els.searchInput.value = btn.dataset.term || '';
          toggleSearch(true);
        });
      });

      // đóng panel tìm kiếm ban đầu
      if (els.searchPanel) {
        els.searchPanel.setAttribute('hidden', '');
      }

      render();
    </script>
  </body>
</html>
